ARIHANT_URL = "https://bcast.arihantspot.com:7768/VOTSBroadcastStreaming/Services/xml/GetLiveRateByTemplateID/arihant"

def fetch_arihant_live():
    headers = {
        "User-Agent": "Mozilla/5.0",
        "Referer": "https://www.arihantspot.in/",
        "Accept": "*/*"
    }

    params = {
        "_": int(time.time() * 1000)  # SAME AS BROWSER
    }

    r = requests.get(
        ARIHANT_URL,
        headers=headers,
        params=params,
        timeout=10
    )
    r.raise_for_status()

    root = ET.fromstring(r.text)

    rates = {}
    last_symbol = None

    for node in root.iter():
        tag = node.tag.lower()

        if tag.endswith("symbol"):
            last_symbol = node.text

        if tag.endswith("rate") and last_symbol:
            try:
                rates[last_symbol] = float(node.text)
            except:
                pass

    return rates
